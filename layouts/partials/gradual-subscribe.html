<!-- 
  Simplified Newsletter Subscription System
  
  TRACKING METHOD:
  - Uses localStorage (browser storage) to track user behavior
  - No server-side user accounts required
  - GDPR-friendly: only stores functional preferences, no personal data
  
  SINGLE STATE:
  - All users: Subtle expandable reminder at bottom-right
  
  SMART FEATURES:
  - Subscription success stops all future prompts
  - "No thanks" respected permanently
  - Source tracking for analytics
-->
<div id="subscribe-system">
  <!-- Centered Subscription Modal -->
  <div id="subscription-modal" class="subscription-modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <button id="modal-close" class="modal-close" title="Close">√ó</button>
      <div class="modal-body">
        <h2>Stay close to the frontier</h2>
        <p>Get updates when I publish new insights about design, technology, and human interaction patterns.</p>
        <form id="subscription-form" class="centered-subscribe-form">
          <input type="email" id="subscription-email" placeholder="your@email.com" required>
          <button type="submit" class="submit-btn">Subscribe</button>
        </form>
        <div id="subscription-message" class="form-message"></div>
        <div class="modal-footer">
          <button id="modal-no-thanks" class="no-thanks-btn">No thanks</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Expandable Bottom-Right for All Users -->
  <div id="user-reminder" class="returning-reminder hidden">
    <!-- Collapsed State -->
    <div id="reminder-collapsed" class="reminder-collapsed clickable">
      <span class="reminder-text">Explore More Content</span>
      <div class="expand-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m18 15-6-6-6 6"/>
        </svg>
      </div>
    </div>
    
    <!-- Expanded State -->
    <div id="reminder-expanded" class="reminder-expanded hidden">
      <div class="expanded-header">
        <h4>Stay close to the frontier</h4>
        <button id="reminder-close" class="reminder-close" title="Minimize">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6 9l6 6 6-6"/>
          </svg>
        </button>
      </div>
      <p>Get updates when I publish new insights about design, technology, and human interaction patterns.</p>
      
      <div class="action-options">
        <a href="/posts/" class="action-item">
          <div class="action-icon">üìñ</div>
          <span class="action-text">Read an article</span>
          <div class="action-arrow">‚Ä∫</div>
        </a>
        
        <a href="https://crowdlisten.com" target="_blank" class="action-item">
          <div class="action-icon">üë•</div>
          <span class="action-text">Understand users with Crowdlisten</span>
          <div class="action-arrow">‚Ä∫</div>
        </a>
        
        <div class="action-item subscribe-item">
          <div class="action-icon">‚úâÔ∏è</div>
          <span class="action-text">Subscribe for updates</span>
          <div class="action-arrow">‚Ä∫</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
class SimplifiedSubscribe {
  constructor() {
    this.init();
  }

  init() {
    // Show for ALL users as requested
    this.setupEventListeners();
    this.showUserReminder();
  }

  // Storage methods
  hasSubscribed() {
    return localStorage.getItem('newsletter-subscribed') === 'true';
  }

  hasPermanentlyDismissed() {
    return localStorage.getItem('newsletter-never-show') === 'true';
  }

  // Show reminder for all users
  showUserReminder() {
    document.getElementById('user-reminder').classList.remove('hidden');
  }

  hideUserReminder() {
    document.getElementById('user-reminder').classList.add('hidden');
  }

  // Expand/Collapse Reminder
  expandReminder() {
    document.getElementById('reminder-collapsed').classList.add('hidden');
    document.getElementById('reminder-expanded').classList.remove('hidden');
  }

  collapseReminder() {
    const expanded = document.getElementById('reminder-expanded');
    const collapsed = document.getElementById('reminder-collapsed');
    
    // Add collapse animation
    expanded.style.animation = 'collapseVertical 0.2s ease-in forwards';
    
    setTimeout(() => {
      expanded.classList.add('hidden');
      expanded.style.animation = '';
      collapsed.classList.remove('hidden');
    }, 200);
  }

  // Show centered subscription modal
  showCenteredModal() {
    document.getElementById('subscription-modal').classList.remove('hidden');
  }

  // Hide centered subscription modal
  hideCenteredModal() {
    document.getElementById('subscription-modal').classList.add('hidden');
  }

  // Form submission
  async submitSubscription(email, source) {
    try {
      const pageUrl = window.location.href;
      
      const response = await fetch('https://script.google.com/macros/s/AKfycbxF7czbmo2JEeATzFoMnHIfGASoSTzogbjJcuQm30sjBXFqmDOqISWkIHBr64GdmURS/exec', {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
          'email': email,
          'pageUrl': pageUrl,
          'source': source
        })
      });

      // Mark as subscribed
      localStorage.setItem('newsletter-subscribed', 'true');
      
      // Reset to action options view instead of hiding
      setTimeout(() => {
        this.resetToActionOptions();
      }, 2000);

      return true;
    } catch (error) {
      console.error('Subscription error:', error);
      return false;
    }
  }

  // Reset to action options view after subscription
  resetToActionOptions() {
    this.hideCenteredModal();
    // Reset form
    document.getElementById('subscription-email').value = '';
    document.getElementById('subscription-message').textContent = '';
    document.getElementById('subscription-message').classList.remove('success', 'error');
  }

  // Event listeners
  setupEventListeners() {
    // User Reminder Events - Make entire collapsed div clickable
    document.getElementById('reminder-collapsed')?.addEventListener('click', () => {
      this.expandReminder();
    });

    document.getElementById('reminder-close')?.addEventListener('click', () => {
      this.collapseReminder();
    });

    // Subscribe action item click
    document.querySelector('.subscribe-item')?.addEventListener('click', () => {
      this.showCenteredModal();
    });

    document.getElementById('user-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('user-email').value;
      const messageEl = document.getElementById('user-message');
      const submitBtn = e.target.querySelector('button[type="submit"]');
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'Subscribing...';
      
      const success = await this.submitSubscription(email, 'user-reminder');
      
      if (success) {
        messageEl.textContent = 'Thanks for subscribing!';
        messageEl.classList.add('success');
        setTimeout(() => this.hideUserReminder(), 2000);
      } else {
        messageEl.textContent = 'Something went wrong. Please try again.';
        messageEl.classList.add('error');
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Subscribe';
    });


    // Centered modal events
    document.getElementById('modal-close')?.addEventListener('click', () => {
      this.hideCenteredModal();
    });

    document.querySelector('.modal-overlay')?.addEventListener('click', () => {
      this.hideCenteredModal();
    });

    document.getElementById('subscription-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('subscription-email').value;
      const messageEl = document.getElementById('subscription-message');
      const submitBtn = e.target.querySelector('button[type="submit"]');
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'Subscribing...';
      
      const success = await this.submitSubscription(email, 'centered-modal');
      
      if (success) {
        messageEl.textContent = 'Thanks for subscribing!';
        messageEl.classList.add('success');
        setTimeout(() => this.hideCenteredModal(), 2000);
      } else {
        messageEl.textContent = 'Something went wrong. Please try again.';
        messageEl.classList.add('error');
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Subscribe';
    });

    document.getElementById('modal-no-thanks')?.addEventListener('click', () => {
      this.hideCenteredModal();
    });
  }
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  new SimplifiedSubscribe();
});
</script>

<style>
/* Simplified Subscribe Styles - PaperMod Theme Integration */
.hidden {
  display: none !important;
}

/* Centered Subscription Modal */
.subscription-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.4s ease-out;
}

.modal-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(4px);
}

.subscription-modal .modal-content {
  position: relative;
  background: var(--entry);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  max-width: 680px;
  width: 95%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow);
  animation: modalSlideIn 0.5s ease-out;
  font-family: inherit;
}

.modal-close {
  position: absolute;
  top: 20px;
  right: 20px;
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--secondary);
  padding: 8px;
  border-radius: var(--radius);
  transition: all 0.2s ease;
  opacity: 0.6;
}

.modal-close:hover {
  opacity: 1;
  background: var(--theme);
  color: var(--primary);
}

.modal-body {
  padding: calc(var(--gap) * 2);
  text-align: center;
}

.modal-body h2 {
  margin: 0 0 24px 0;
  font-size: 32px;
  font-weight: 700;
  color: var(--primary);
  font-family: inherit;
  line-height: 1.2;
}

.modal-body p {
  margin: 0 0 32px 0;
  color: var(--secondary);
  line-height: 1.6;
  font-size: 16px;
  font-family: inherit;
  max-width: 480px;
  margin-left: auto;
  margin-right: auto;
}

/* Centered Subscribe Form */
.centered-subscribe-form {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-bottom: 24px;
  max-width: 400px;
  margin-left: auto;
  margin-right: auto;
}

.centered-subscribe-form input {
  padding: 16px 20px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  font-size: 16px;
  background: var(--theme);
  color: var(--primary);
  font-family: inherit;
  transition: border-color 0.2s ease;
  text-align: center;
}

.centered-subscribe-form input::placeholder {
  color: var(--secondary);
  opacity: 0.7;
}

.centered-subscribe-form input:focus {
  outline: none;
  border-color: var(--primary);
}

.centered-subscribe-form .submit-btn {
  background: var(--primary);
  color: var(--theme);
  border: none;
  padding: 16px 24px;
  border-radius: var(--radius);
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  font-family: inherit;
}

.centered-subscribe-form .submit-btn:hover {
  opacity: 0.9;
  transform: translateY(-1px);
}

.centered-subscribe-form .submit-btn:disabled {
  opacity: 0.6;
  transform: none;
  cursor: not-allowed;
}

.modal-footer {
  text-align: center;
  margin-top: 16px;
}

/* User Reminder: Bottom-Right Expandable */

/* Subscribe Form */
.subscribe-form {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 16px;
  width: 100%;
}

.subscribe-form input {
  padding: 14px 16px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  font-size: 14px;
  background: var(--theme);
  color: var(--primary);
  font-family: inherit;
  transition: border-color 0.2s ease;
  box-sizing: border-box;
  width: 100%;
  text-align: left;
}

.subscribe-form input::placeholder {
  color: var(--secondary);
  opacity: 0.7;
}

.subscribe-form input:focus {
  outline: none;
  border-color: var(--primary);
}

.submit-btn {
  background: var(--primary);
  color: var(--theme);
  border: none;
  padding: 14px 16px;
  border-radius: var(--radius);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  font-family: inherit;
  box-sizing: border-box;
  width: 100%;
}

.no-thanks-btn {
  background: none;
  border: none;
  color: var(--secondary);
  font-size: 14px;
  cursor: pointer;
  text-decoration: underline;
  font-family: inherit;
  transition: color 0.2s ease;
  opacity: 0.8;
}

.no-thanks-btn:hover {
  color: var(--primary);
  opacity: 1;
}

/* User Reminder */
.returning-reminder {
  position: fixed;
  bottom: 0;
  right: 0;
  z-index: 999;
  font-family: inherit;
}

/* Collapsed State */
.reminder-collapsed {
  background: var(--entry);
  border: 1px solid var(--border);
  border-radius: calc(var(--radius) * 2) calc(var(--radius) * 2) 0 0;
  padding: 12px 20px;
  box-shadow: var(--shadow);
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  transition: all 0.3s ease;
  user-select: none;
  width: 399px;
  margin: 0;
}

.reminder-collapsed.clickable {
  cursor: pointer;
}

.reminder-collapsed:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(0,0,0,0.15);
}

.reminder-text {
  font-size: 14px;
  color: var(--secondary);
  font-weight: 500;
  white-space: nowrap;
}

.expand-btn {
  background: var(--theme);
  border: 1px solid var(--border);
  border-radius: 50%;
  padding: 6px;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--secondary);
  pointer-events: none;
}

.reminder-collapsed:hover .expand-btn {
  background: var(--border);
  color: var(--primary);
}

/* Expanded State */
.reminder-expanded {
  background: var(--entry);
  border: 1px solid var(--border);
  border-radius: var(--radius) var(--radius) 0 0;
  padding: 24px;
  box-shadow: var(--shadow);
  width: 399px;
  animation: expandVertical 0.3s ease-out;
  margin: 0;
  box-sizing: border-box;
}

.expanded-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.expanded-header h4 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: var(--primary);
  font-family: inherit;
}

.reminder-close {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--secondary);
  padding: 4px;
  transition: all 0.2s ease;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.reminder-close:hover {
  color: var(--primary);
  background: var(--theme);
}

.reminder-expanded p {
  margin: 0 0 20px 0;
  font-size: 14px;
  color: var(--secondary);
  line-height: 1.6;
  font-family: inherit;
}

/* Action Options */
.action-options {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 16px;
}

.action-item {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: var(--theme);
  color: var(--primary);
  text-decoration: none;
  transition: all 0.2s ease;
  cursor: pointer;
}

.action-item:hover {
  background: var(--code-bg);
  border-color: var(--primary);
}

.action-icon {
  font-size: 16px;
  margin-right: 12px;
  min-width: 20px;
}

.action-text {
  flex: 1;
  font-size: 14px;
  font-weight: 500;
}

.action-arrow {
  font-size: 18px;
  color: var(--secondary);
  margin-left: 8px;
}

.action-item:hover .action-arrow {
  color: var(--primary);
}

.reminder-actions {
  text-align: center;
  margin-top: 16px;
}

/* Form Messages */
.form-message {
  margin-top: 16px;
  padding: 12px 16px;
  border-radius: var(--radius);
  font-size: 14px;
  text-align: center;
  font-family: inherit;
}

.form-message.success {
  background: var(--code-bg);
  color: var(--primary);
  border: 1px solid var(--border);
}

.form-message.error {
  background: var(--code-bg);
  color: var(--primary);
  border: 1px solid var(--border);
}

/* Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes modalSlideIn {
  from {
    transform: scale(0.95) translateY(-10px);
    opacity: 0;
  }
  to {
    transform: scale(1) translateY(0);
    opacity: 1;
  }
}

@keyframes expandVertical {
  from {
    transform: scaleY(0);
    transform-origin: bottom;
    opacity: 0;
  }
  to {
    transform: scaleY(1);
    transform-origin: bottom;
    opacity: 1;
  }
}

@keyframes collapseVertical {
  from {
    transform: scaleY(1);
    transform-origin: bottom;
    opacity: 1;
  }
  to {
    transform: scaleY(0);
    transform-origin: bottom;
    opacity: 0;
  }
}

/* Mobile responsiveness */
@media (max-width: 768px) {
  .new-user-modal .modal-content {
    margin: 20px;
    width: calc(100% - 40px);
  }
  
  .modal-body {
    padding: var(--gap);
  }
  
  .modal-body h2 {
    font-size: 28px;
  }
  
  .returning-reminder {
    right: 0;
    bottom: 0;
  }
  
  .reminder-expanded {
    width: 100vw;
    max-width: 399px;
    padding: 16px;
  }
  
  .reminder-collapsed {
    padding: 10px 16px;
    width: 100vw;
    max-width: 399px;
  }
  
  .reminder-text {
    font-size: 13px;
  }
}

/* PaperMod theme variable fallbacks */
:root {
  --main-width: 720px;
  --gap: 24px;
  --radius: 8px;
  --shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
</style>